<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>LieroT</title>
    <script src="./client/game.js" type="text/javascript"></script>
    <script src="/client/sha-hash.js" type="text/javascript"></script>
    <script src="./client/messagebroker.js" type="text/javascript"></script>
    <script src="./client/messagehandler.js" type="text/javascript"></script>
    <script src="./common/messages.js" type="text/javascript"></script>
    <link rel="stylesheet" href="client/style.css">
    <script type="text/javascript">
        function lataaLieroT() {
            peli = new Peli();
        }

        function kirjaudu() {
            // Tarkista syötteet
            if (document.getElementById("kayttajanimi").value && document.getElementById("salasana").value) {
                // Lähetä kirjautumispyyntö
                var msg = messages.message.AUTH_REQ.new();
                msg.username = document.getElementById("kayttajanimi").value;
                msg.passwordhash = Sha1.hash(document.getElementById("salasana").value);
                peli.messageHandler.send(msg);
            }
        }

        function rekisteroidy() {
            // Tarkista syötteet
            if (document.getElementById("kayttajanimi").value && document.getElementById("salasana").value) {
                // Lähetä kirjautumispyyntö
                var msg = messages.message.REG_REQ.new();
                msg.username = document.getElementById("kayttajanimi").value;
                msg.passwordhash = Sha1.hash(document.getElementById("salasana").value);
                peli.messageHandler.send(msg);
            }
        }
        
        function poistu() {
            // TODO: lähetä LOGOUT-viesti palvelimelle?
            location.reload();
        }

        function handleKeypress(event) {
            event.preventDefault;
            console.log("event.which:", event.which, "event.keyCode:", event.keyCode, "event.charCode:", event.charCode);
            if (event.which == 13 || event.keyCode == 13) {
                // Lähetä tekstirimpsu jos sen pituus > 0
                var chatmsg = document.getElementById('keskusteluviesti').value;
                if (chatmsg) {
                    var msg = messages.message.CHAT_SYNC.new();
                    msg.username = peli.messageHandler.getUsername();
                    msg.text = chatmsg;
                    peli.messageHandler.send(msg);
                    document.getElementById('keskusteluviesti').value = "";
                }
            }
            return true; // Huom! return false; ei lisää merkkiä textboxiin
        }
        
        function pelisyote(event) {

            if (true == peli.onKaynnissa()) {
                peli.kasittelePainallus(event);
            }
            return true; // Huom! return false; ei lisää merkkiä textboxiin
        }
    </script>
</head>

<body onload="lataaLieroT();" onkeypress="return pelisyote(event)">
<div class="container">
    <div id="kirjautuminen">
        <div id="kirjautumisikkuna">
        <fieldset>
            <legend><strong>Kirjautuminen</strong></legend>
            <div id="infoteksti">
                <p>
                    Käyttäjänimi: <input type="text" id="kayttajanimi" length="10">
                    Salasana: <input type="password" id="salasana" length="10">
                    <input id="kirjaudu_painike" type="submit" value="Kirjaudu" onclick="kirjaudu()">
                    <input id="rekisteroidy_painike" type="submit" value="Rekisteroidy" onclick="rekisteroidy()">
                </p>
            </div>
        </fieldset>
        </div>
    </div>
    <div id="kirjautuneet">
        <fieldset>
            <legend><strong>Kirjautuneet</strong></legend>
            <div id="kirjautuneetpelaajat">
            </div>
        </fieldset>
    </div>
    <div id="rankinglista">
        <fieldset>
            <legend><strong>Ranking</strong></legend>
            <div id="pelaaja">
            </div>
        </fieldset>
    </div>
    <div id="pelilauta" onkeypress="return pelisyote(event)">
        <p>Sinun on kirjauduttava aloittaaksesi pelin.</p>
    </div>
    <div id="chatti">
        <fieldset>
            <legend><strong>Keskustelu</strong></legend>
            <div id="keskustelualue">
                <div id="viestialue"></div>
            </div>
            <div id="lahetaviesti">
                L&auml;het&auml: <input type="text" id="keskusteluviesti" size="40" maxlength="100" onkeypress="return handleKeypress(event)">
            </div>
        </fieldset>
    </div>
    <div id="palvelintiedot">
        <fieldset>
            <legend><strong>Palvelimen loki</strong></legend>
            <div id="palvelinloki">
            </div>
        </fieldset>
    </div>
</div>
</body>
</html>
